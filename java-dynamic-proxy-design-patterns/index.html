<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Java 动态代理 - midFang&#39;s Blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="midFang" />
  <meta name="description" content="动态代理和静态代理一般在设计模式中的定义为代理设计模式 定义： 为其他对象提供一种代理以控制对这个对象的访问 使用场景： 当无法或者不想直接访问某个" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.58.3" />


<link rel="canonical" href="https://midFang.github.io/java-dynamic-proxy-design-patterns/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Java 动态代理" />
<meta property="og:description" content="动态代理和静态代理一般在设计模式中的定义为代理设计模式 定义： 为其他对象提供一种代理以控制对这个对象的访问 使用场景： 当无法或者不想直接访问某个" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://midFang.github.io/java-dynamic-proxy-design-patterns/" />
<meta property="article:published_time" content="2020-01-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-10T00:00:00+00:00" />
<meta itemprop="name" content="Java 动态代理">
<meta itemprop="description" content="动态代理和静态代理一般在设计模式中的定义为代理设计模式 定义： 为其他对象提供一种代理以控制对这个对象的访问 使用场景： 当无法或者不想直接访问某个">


<meta itemprop="datePublished" content="2020-01-10T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-01-10T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3154">



<meta itemprop="keywords" content="Android,数据结构," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java 动态代理"/>
<meta name="twitter:description" content="动态代理和静态代理一般在设计模式中的定义为代理设计模式 定义： 为其他对象提供一种代理以控制对这个对象的访问 使用场景： 当无法或者不想直接访问某个"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">midFang's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/post/">全部文章</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/about/">关于</a>
          
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = '57787f7f4d21d54fc';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      midFang's Blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/post/">全部文章</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://midFang.github.io/about/">关于</a>
          

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Java 动态代理</h1>
      
      <div class="post-meta">
        <time datetime="2020-01-10" class="post-time">
          2020-01-10
        </time>
        <div class="post-category">
            <a href="https://midFang.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"> 数据结构 </a>
            
          </div>
        

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
          <span id="/java-dynamic-proxy-design-patterns/" class="leancloud_visitors" data-flag-title="Java 动态代理">
            <span class="post-meta-item-text"> | 阅读 </span>
            <span class="leancloud-visitors-count"></span>
          </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#一般有-3-种角色">一般有 3 种角色</a></li>
</ul></li>
</ul></li>
<li><a href="#静态代理">静态代理</a></li>
<li><a href="#动态代理">动态代理</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<p>动态代理和静态代理一般在设计模式中的定义为代理设计模式</p>

<p>定义： 为其他对象提供一种代理以控制对这个对象的访问</p>

<p>使用场景： 当无法或者不想直接访问某个对象时，或者访问对象存在一定的困难，可以通过代理对象来间接访问，为了保证客户端使用的透明性，委托对象和代理对象需要实现相同的<strong>接口</strong></p>

<h4 id="一般有-3-种角色">一般有 3 种角色</h4>

<ul>
<li>抽象主题类：一般指的是真实主题类和代理类的共性<strong>接口</strong>，或者叫目标接口</li>
<li>真实主题类：一般指的是有真实的目标需求的类，或者叫被代理类</li>
<li>代理类：一般指的是代理真实主题类，去完成真实主题类想要完成的事情，也就是代理，对真实主题类存在引用关系</li>
</ul>

<h2 id="静态代理">静态代理</h2>

<p>假设有 IBank 抽象主题类，也就是接口，代理类和被代理类都需要实现的共性接口，完成实际要做的事情</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></pre></td>
<td class="lntd">
<pre class="chroma">// 目标业务接口
public interface IBank {

    /**
     * 办卡
     */
    void applyBank();
}</pre></td></tr></table>
</div>
</div>
<p>被代理类对象，有真实需求的目标用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></pre></td>
<td class="lntd">
<pre class="chroma">// 某男士
public class Man implements IBank {

    private String name;

    public Man(String name) {
        this.name = name;
    }


    @Override
    public void applyBank() {
        System.out.println(name + &#34; 需要申请办卡 &#34;);
    }
}</pre></td></tr></table>
</div>
</div>
<p>代理对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></pre></td>
<td class="lntd">
<pre class="chroma">// 银行办卡工作人员
public class BankWorker implements IBank {

    private IBank mIBank;

    //代理对象给被代理对象 办理业务
    public BankWorker(IBank iBank) {
        this.mIBank = iBank;
    }

    @Override
    public void applyBank() {
        System.out.println(&#34;请问需要办理什么也去&#34;);
        mIBank.applyBank();
        System.out.println(&#34;办理完毕&#34;);
    }
}</pre></td></tr></table>
</div>
</div>
<p>这里简单解释一下，也就是说有某个男士想要办理银行的办卡业务，但是他并不知道具体的流程是怎么样的，所以他需要一个代理人去帮他完成办卡业务，那么这个时候，代理对象也需要知道他具体要办的是什么业务，所以都需要实现目标业务接口</p>

<p>假如这个时候，这个男士又要办理其他的业务了，那么需要在目标接口中增加方法，同时代理对象和被代理对象都需要实现，不太方便，那么这就是静态代理，也就是有一个一对一的关系，其实代理对象可以使用 Java 提供的一个 Proxy 动态代理类完成，那么在编译的时候无需实现方法</p>

<h2 id="动态代理">动态代理</h2>

<p>假设还是上述的银行办卡业务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></pre></td>
<td class="lntd">
<pre class="chroma">// 目标接口
public interface IBank {

    /**
     * 办卡
     */
    void applyBank();
}</pre></td></tr></table>
</div>
</div>
<p>被代理对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></pre></td>
<td class="lntd">
<pre class="chroma">public class Man implements IBank {

    private String name;

    public Man(String name) {
        this.name = name;
    }

    @Override
    public void applyBank() {
        System.out.println(name + &#34; 需要申请办卡 &#34;);
    }
}</pre></td></tr></table>
</div>
</div>
<p>动态代理对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></pre></td>
<td class="lntd">
<pre class="chroma">public class BankInvocationHandler implements InvocationHandler {

    private Object mObject;

    /**
     * @param object 被代理对象
     */
    public BankInvocationHandler(Object object) {
        this.mObject = object;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
      //  System.out.println(&#34;method &#34; + method.getName());

        System.out.println(&#34;需要办理什么业务&#34;);
        // 反射执行方式
        method.invoke(mObject, args);  // 执行的就是 mObject 被代理对象的方法
        System.out.println(&#34;办理完毕&#34;);

        return null;
    }
}</pre></td></tr></table>
</div>
</div>
<p>客户端进行调用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></pre></td>
<td class="lntd">
<pre class="chroma">Man man = new Man(&#34;xiaoming&#34;);

// 返回的是 接口的实例对象
IBank iBank = (IBank) Proxy.newProxyInstance(IBank.class.getClassLoader(),
                new Class[]{IBank.class},new BankInvocationHandler(man));

//办理业务
iBank.applyBank();</pre></td></tr></table>
</div>
</div>
<p>那么动态代理就已经完成了，那么回到上述刚才提到的一个问题，如果是静态代理的话，如果增加了一个新的挂失卡的业务的话，那么静态代理中的目标接口、被代理对象，代理对象，都需要需要这个方法，这样不太方法，那么假如是这个动态代理又是怎样的呢？</p>

<p>动态代理只需要目标接口中增加业务，被代理对象中，增加业务，即可，和上述相比是不是更加方便了一些，少了一些操作，少了一个代理对象</p>

<p>那么他是如何完成这个动作的呢 ？ 它主要是通过这个方法 Proxy.newProxyInstance 去创建了一个对象，我们看看源码是如何完成的</p>

<p>这里可以通过 Debug 看看这个对象到底是什么，可以发现打印了一个 $Proxy0@463 的对象</p>

<p><img src="https://raw.githubusercontent.com/checkFang/img/master/20200620163244.png" alt="" /></p>

<p>Proxy.newProxyInstance 的源码，以下省略部分代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></pre></td>
<td class="lntd">
<pre class="chroma">public static Object newProxyInstance(ClassLoader loader,
                                          Class&lt;?&gt;[] interfaces,
                                          InvocationHandler h)
        throws IllegalArgumentException
    {
        if (h == null) {
            throw new NullPointerException();
        }

        /*
         * Look up or generate the designated proxy class.
         */
        // 获取class 类
        Class&lt;?&gt; cl = getProxyClass0(loader, intfs);

        /*
         * Invoke its constructor with the designated invocation handler.
         */
        try {
        		// 获取了构造方法
            final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);
            final InvocationHandler ih = h;
            if (sm != null &amp;&amp; ProxyAccessHelper.needsNewInstanceCheck(cl)) {
                // create proxy instance with doPrivilege as the proxy class may
                // implement non-public interfaces that requires a special permission
                return AccessController.doPrivileged(new PrivilegedAction&lt;Object&gt;() {
                    public Object run() {
                    		// 创建了实例
                        return newInstance(cons, ih);
                    }
                });
            } else {
                return newInstance(cons, ih);
            }
        } catch (NoSuchMethodException e) {
            throw new InternalError(e.toString());
        }
    }</pre></td></tr></table>
</div>
</div>
<p>上面我们发现通过 Class&lt;?&gt; cl = getProxyClass0(loader, intfs) 获取了 Class， 然后通过构造的方式反射创建实例对象，那么这里主要看 getProxyClass0 是如何创建的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></pre></td>
<td class="lntd">
<pre class="chroma">    private static Class&lt;?&gt; getProxyClass0(ClassLoader loader,
                                           Class&lt;?&gt;... interfaces) {
        if (interfaces.length &gt; 65535) {
            throw new IllegalArgumentException(&#34;interface limit exceeded&#34;);
        }

				// 缓存中获取
        return proxyClassCache.get(loader, interfaces);
    }</pre></td></tr></table>
</div>
</div>
<p>可以发现这里做了缓存，继续深入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></pre></td>
<td class="lntd">
<pre class="chroma">public V get(K key, P parameter) {
        Objects.requireNonNull(parameter);

        expungeStaleEntries();

        Object cacheKey = CacheKey.valueOf(key, refQueue);

        // lazily install the 2nd level valuesMap for the particular cacheKey
        ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey);
        if (valuesMap == null) {
            ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap
                = map.putIfAbsent(cacheKey,
                                  valuesMap = new ConcurrentHashMap&lt;&gt;());
            if (oldValuesMap != null) {
                valuesMap = oldValuesMap;
            }
        }

        // create subKey and retrieve the possible Supplier&lt;V&gt; stored by that
        // subKey from valuesMap
        Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter));
        Supplier&lt;V&gt; supplier = valuesMap.get(subKey);
        Factory factory = null;

    }</pre></td></tr></table>
</div>
</div>
<p>这里主要使用的是 subKeyFactory.apply(key, parameter) 来创建的，我们继续看看里面干了什么，这个类其实是 ProxyClassFactory 中处理的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></pre></td>
<td class="lntd">
<pre class="chroma"><span class="nx">private</span> <span class="nx">static</span> <span class="nx">final</span> <span class="nx">String</span> <span class="nx">proxyClassNamePrefix</span> <span class="p">=</span> <span class="s">&#34;$Proxy&#34;</span><span class="p">;</span>

<span class="nx">private</span> <span class="nx">static</span> <span class="nx">final</span> <span class="nx">class</span> <span class="nx">ProxyClassFactory</span>
        <span class="nx">implements</span> <span class="nx">BiFunction</span><span class="p">&lt;</span><span class="nx">ClassLoader</span><span class="p">,</span> <span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;[],</span> <span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="o">&gt;&gt;</span>
    <span class="p">{</span>
        <span class="c1">// prefix for all proxy class names
</span><span class="c1"></span>        <span class="nx">private</span> <span class="nx">static</span> <span class="nx">final</span> <span class="nx">String</span> <span class="nx">proxyClassNamePrefix</span> <span class="p">=</span> <span class="s">&#34;$Proxy&#34;</span><span class="p">;</span>

        <span class="c1">// next number to use for generation of unique proxy class names
</span><span class="c1"></span>        <span class="nx">private</span> <span class="nx">static</span> <span class="nx">final</span> <span class="nx">AtomicLong</span> <span class="nx">nextUniqueNumber</span> <span class="p">=</span> <span class="nx">new</span> <span class="nf">AtomicLong</span><span class="p">();</span>

        <span class="err">@</span><span class="nx">Override</span>
        <span class="nx">public</span> <span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;</span> <span class="nf">apply</span><span class="p">(</span><span class="nx">ClassLoader</span> <span class="nx">loader</span><span class="p">,</span> <span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;[]</span> <span class="nx">interfaces</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">Map</span><span class="p">&lt;</span><span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;,</span> <span class="nx">Boolean</span><span class="p">&gt;</span> <span class="nx">interfaceSet</span> <span class="p">=</span> <span class="nx">new</span> <span class="nx">IdentityHashMap</span><span class="p">&lt;&gt;(</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;</span> <span class="nx">intf</span> <span class="p">:</span> <span class="nx">interfaces</span><span class="p">)</span> <span class="p">{</span>
                <span class="cm">/*
</span><span class="cm">                 * Verify that the class loader resolves the name of this
</span><span class="cm">                 * interface to the same Class object.
</span><span class="cm">                 */</span>
                <span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;</span> <span class="nx">interfaceClass</span> <span class="p">=</span> <span class="nx">null</span><span class="p">;</span>
                <span class="nx">try</span> <span class="p">{</span>
                    <span class="nx">interfaceClass</span> <span class="p">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nf">forName</span><span class="p">(</span><span class="nx">intf</span><span class="p">.</span><span class="nf">getName</span><span class="p">(),</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">loader</span><span class="p">);</span>
                <span class="p">}</span> <span class="nf">catch</span> <span class="p">(</span><span class="nx">ClassNotFoundException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">interfaceClass</span> <span class="o">!=</span> <span class="nx">intf</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">throw</span> <span class="nx">new</span> <span class="nf">IllegalArgumentException</span><span class="p">(</span>
                        <span class="nx">intf</span> <span class="o">+</span> <span class="s">&#34; is not visible from class loader&#34;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="cm">/*
</span><span class="cm">                 * Verify that the Class object actually represents an
</span><span class="cm">                 * interface.
</span><span class="cm">                 */</span>
                <span class="k">if</span> <span class="p">(!</span><span class="nx">interfaceClass</span><span class="p">.</span><span class="nf">isInterface</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nx">throw</span> <span class="nx">new</span> <span class="nf">IllegalArgumentException</span><span class="p">(</span>
                        <span class="nx">interfaceClass</span><span class="p">.</span><span class="nf">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34; is not an interface&#34;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="cm">/*
</span><span class="cm">                 * Verify that this interface is not a duplicate.
</span><span class="cm">                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">interfaceSet</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="nx">interfaceClass</span><span class="p">,</span> <span class="nx">Boolean</span><span class="p">.</span><span class="nx">TRUE</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">throw</span> <span class="nx">new</span> <span class="nf">IllegalArgumentException</span><span class="p">(</span>
                        <span class="s">&#34;repeated interface: &#34;</span> <span class="o">+</span> <span class="nx">interfaceClass</span><span class="p">.</span><span class="nf">getName</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">String</span> <span class="nx">proxyPkg</span> <span class="p">=</span> <span class="nx">null</span><span class="p">;</span>     <span class="c1">// package to define proxy class in
</span><span class="c1"></span>
            <span class="cm">/*
</span><span class="cm">             * Record the package of a non-public proxy interface so that the
</span><span class="cm">             * proxy class will be defined in the same package.  Verify that
</span><span class="cm">             * all non-public proxy interfaces are in the same package.
</span><span class="cm">             */</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">Class</span><span class="p">&lt;</span><span class="err">?</span><span class="p">&gt;</span> <span class="nx">intf</span> <span class="p">:</span> <span class="nx">interfaces</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="nx">flags</span> <span class="p">=</span> <span class="nx">intf</span><span class="p">.</span><span class="nf">getModifiers</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(!</span><span class="nx">Modifier</span><span class="p">.</span><span class="nf">isPublic</span><span class="p">(</span><span class="nx">flags</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">String</span> <span class="nx">name</span> <span class="p">=</span> <span class="nx">intf</span><span class="p">.</span><span class="nf">getName</span><span class="p">();</span>
                    <span class="kt">int</span> <span class="nx">n</span> <span class="p">=</span> <span class="nx">name</span><span class="p">.</span><span class="nf">lastIndexOf</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span>
                    <span class="nx">String</span> <span class="nx">pkg</span> <span class="p">=</span> <span class="p">((</span><span class="nx">n</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="err">?</span> <span class="s">&#34;&#34;</span> <span class="p">:</span> <span class="nx">name</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">proxyPkg</span> <span class="o">==</span> <span class="nx">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">proxyPkg</span> <span class="p">=</span> <span class="nx">pkg</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(!</span><span class="nx">pkg</span><span class="p">.</span><span class="nf">equals</span><span class="p">(</span><span class="nx">proxyPkg</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">throw</span> <span class="nx">new</span> <span class="nf">IllegalArgumentException</span><span class="p">(</span>
                            <span class="s">&#34;non-public interfaces from different packages&#34;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">proxyPkg</span> <span class="o">==</span> <span class="nx">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// if no non-public proxy interfaces, use com.sun.proxy package
</span><span class="c1"></span>                <span class="nx">proxyPkg</span> <span class="p">=</span> <span class="nx">ReflectUtil</span><span class="p">.</span><span class="nx">PROXY_PACKAGE</span> <span class="o">+</span> <span class="s">&#34;.&#34;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="cm">/*
</span><span class="cm">             * Choose a name for the proxy class to generate.
</span><span class="cm">             */</span>
            <span class="c1">// 数字叠加
</span><span class="c1"></span>            <span class="nx">long</span> <span class="nx">num</span> <span class="p">=</span> <span class="nx">nextUniqueNumber</span><span class="p">.</span><span class="nf">getAndIncrement</span><span class="p">();</span>
            <span class="c1">// 代理类名字的由来 proxyClassNamePrefix 就是 $Proxy
</span><span class="c1"></span>            <span class="nx">String</span> <span class="nx">proxyName</span> <span class="p">=</span> <span class="nx">proxyPkg</span> <span class="o">+</span> <span class="nx">proxyClassNamePrefix</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>

            <span class="cm">/*
</span><span class="cm">               生成了一个代理类 class 的一个数组
</span><span class="cm">             * Generate the specified proxy class.
</span><span class="cm">             */</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="nx">proxyClassFile</span> <span class="p">=</span> <span class="nx">ProxyGenerator</span><span class="p">.</span><span class="nf">generateProxyClass</span><span class="p">(</span>
                <span class="nx">proxyName</span><span class="p">,</span> <span class="nx">interfaces</span><span class="p">);</span>
           
    <span class="p">}</span></pre></td></tr></table>
</div>
</div>
<p>到了这里我们可以发现动态的创建了一个代理类的一个数组，也知道了名字的由来了，那么生成的代理类到底长什么样子呢 ？我们通过一个工具类，输出到一个文件中进行查看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></pre></td>
<td class="lntd">
<pre class="chroma">public class ProxyUtils {

    public static void generateClassFile(Class clazz, String proxyName) {
        /*ProxyGenerator.generateProxyClass(
                proxyName, interfaces, accessFlags);*/
        byte[] proxyClassFile = ProxyGenerator.generateProxyClass(
                proxyName, new Class[]{clazz});
        String paths = clazz.getResource(&#34;.&#34;).getPath();
        System.out.println(paths);
        FileOutputStream out = null;

        try {
            out = new FileOutputStream(paths + proxyName + &#34;.class&#34;);
            out.write(proxyClassFile);
            out.flush();
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                out.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}</pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></pre></td>
<td class="lntd">
<pre class="chroma">public final class BankInvocationHandler extends Proxy implements Man {
    private static Method m1;
    private static Method m9;
    private static Method m2;
    private static Method m6;
    private static Method m3;
    private static Method m5;
    private static Method m8;
    private static Method m4;
    private static Method m10;
    private static Method m0;
    private static Method m7;

    public BankInvocationHandler(InvocationHandler var1) throws  {
        super(var1);
    }

    public final boolean equals(Object var1) throws  {
        // 省略部分代码
    }

    public final void notify() throws  {
       // 省略部分代码
    }

    public final String toString() throws  {
      // 省略部分代码
    }

    public final void wait(long var1) throws InterruptedException {
      // 省略部分代码
    }

		// 挂失业务
    public final void loseBank() throws  {
        try {
            super.h.invoke(this, m3, (Object[])null);
        } catch (RuntimeException | Error var2) {
            throw var2;
        } catch (Throwable var3) {
            throw new UndeclaredThrowableException(var3);
        }
    }

    public final void wait(long var1, int var3) throws InterruptedException {
         // 省略部分代码
    }

    public final Class getClass() throws  {
       // 省略部分代码
    }

    public final void applyBank() throws  {
        try {
            super.h.invoke(this, m4, (Object[])null);
        } catch (RuntimeException | Error var2) {
            throw var2;
        } catch (Throwable var3) {
            throw new UndeclaredThrowableException(var3);
        }
    }

    public final void notifyAll() throws  {
        // 省略部分代码
    }

    public final int hashCode() throws  {
       // 省略部分代码
    }

    public final void wait() throws InterruptedException {
      // 省略部分代码
    }

    static {
        try {
            m1 = Class.forName(&#34;java.lang.Object&#34;).getMethod(&#34;equals&#34;, Class.forName(&#34;java.lang.Object&#34;));
            m9 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;notify&#34;);
            m2 = Class.forName(&#34;java.lang.Object&#34;).getMethod(&#34;toString&#34;);
            m6 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;wait&#34;, Long.TYPE);
            m3 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;loseBank&#34;);
            m5 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;wait&#34;, Long.TYPE, Integer.TYPE);
            m8 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;getClass&#34;);
            // 办理卡方法
            m4 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;applyBank&#34;);
            m10 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;notifyAll&#34;);
            m0 = Class.forName(&#34;java.lang.Object&#34;).getMethod(&#34;hashCode&#34;);
            m7 = Class.forName(&#34;com.fangsf.java_lib.proxy.Man&#34;).getMethod(&#34;wait&#34;);
        } catch (NoSuchMethodException var2) {
            throw new NoSuchMethodError(var2.getMessage());
        } catch (ClassNotFoundException var3) {
            throw new NoClassDefFoundError(var3.getMessage());
        }
    }
}</pre></td></tr></table>
</div>
</div>
<p>这里我们可以看到继承一个 proxy 的类，然后还实现了一个 Man 类 ？？？众所周知实现不是只能实现接口吗？怎么这里实现了一个类呢，这里其实是一个障眼法，其实实现的是 IBack 接口，那么就有了目标接口的实际需求了。</p>

<p>我们可以发现一个重要的执行代码 super.h.invoke(this, m4, (Object[])null); 其实 super.h 就是我们创建的代理类BankInvocationHandler ，然后执行了 m4， m4 其实就是这个方法 Class.forName(&ldquo;com.fangsf.java_lib.proxy.Man&rdquo;).getMethod(&ldquo;applyBank&rdquo;)</p>

<p>到这里基本就结束了，我们可以发现其实代理对象其实也是有的，只不过是 Java 帮助我们动态生成了，所以我们不用去写这个类，即使后面增加了目标业务需求，只需要代理对象实现相应方法即可，我们的动态代理类会自动生成的。更加的方便，不过需要注意的是动态代理用了大量的反射，比静态代理会更加耗性能。</p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">midFang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2020-01-10
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://midFang.github.io/tags/android/">Android</a>
          <a href="https://midFang.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/bug-only-fullscreen-opaque-activities-can-request-orientation/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">关于8.0以下出现Only fullscreen opaque activities can request orientation问题的解决方案</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/activity-animation-transfer/">
            <span class="next-text nav-default">Activity 从各个方向进入和退出的转场动画</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "midFang/blog-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://github.com/midFang" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://stackoverflow.com/users/14331888/midfang" rel="me noopener" class="iconfont"
      title="stack-overflow"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M809.714286 932.571429l-638.857143 0 0-274.285714-91.428571 0 0 365.714286 821.714286 0 0-365.714286-91.428571 0 0 274.285714zm-538.285714-299.428571l18.857143-89.714286 447.428571 94.285714-18.857143 89.142857zm58.857143-213.714286l38.285714-83.428571 414.285714 193.714286-38.285714 82.857143zm114.857143-203.428571l58.285714-70.285714 350.857143 293.142857-58.285714 70.285714zm226.857143-216l272.571429 366.285714-73.142857 54.857143-272.571429-366.285714zm-410.285714 840.571429l0-90.857143 457.142857 0 0 90.857143-457.142857 0z"></path>
</svg>

    </a>
  
    <a href="https://www.douban.com/people/194654920/" rel="me noopener" class="iconfont"
      title="douban"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M926.917973 37.80608C959.65184 37.80608 986.19392 64.34816 986.19392 97.082027L986.19392 926.917973C986.19392 959.65184 959.65184 986.19392 926.917973 986.19392L97.082027 986.19392C64.34816 986.19392 37.80608 959.65184 37.80608 926.917973L37.80608 97.082027C37.80608 64.34816 64.34816 37.80608 97.082027 37.80608zM176.653653 176.19968 176.653653 252.678827 825.658027 252.678827 825.658027 176.19968zM217.719467 316.146347 217.719467 628.08064 273.524053 628.08064 341.292373 770.39616 157.259093 770.39616 157.259093 845.417813 842.949973 845.417813 842.949973 770.39616 654.226773 770.39616 722.899627 628.08064 783.67744 628.08064 783.67744 316.146347zM684.885333 392.891733 684.885333 553.987413 312.576 553.987413 312.576 392.891733zM570.770773 770.39616 426.653013 770.39616 359.621973 628.08064 639.443627 628.08064z"></path>
</svg>

    </a>


<a href="https://midFang.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2020 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        midFang
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script type="text/javascript">
    AV.initialize( null ,  null );
  </script>

  <script>
    function showHitCount(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push($(this).attr("id").trim());
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var hits = item.get('hits');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(hits);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function (results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("hits");
            counter.save(null, {
              success: function (counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('hits'));
              },
              error: function (counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
             
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
             
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("hits", 1);
            newcounter.save(null, {
              success: function (newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('hits'));
              },
              error: function (newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function (error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function () {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        
        addCount(Counter);
      } else if ($('.post-link').length > 1) {
        
        showHitCount(Counter);
      }
    });
  </script>





  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>





</body>
</html>
